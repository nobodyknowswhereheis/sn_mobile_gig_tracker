<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="_PRVW__ababf9ee987a23006998ee74213a47c9">b7abf9eedb7a2300f51ef3c61d9619ca</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"4219b377913348b1b2681859ae5963fd","triggerType":"request","id":"4219b377913348b1b2681859ae5963fd"}],"goals":[{"name":"primary","trigger_id":"4219b377913348b1b2681859ae5963fd","nodes":[{"type":"StartGoal","goal_id":"395d0e8aa144436fae5415b45966ecf5","greeting_msg":{"type":"String","mode":"string","value":""},"id":"0af52ead8e224343a1606d95078bcd57","name":"Start"},{"type":"TerminateGoal","goal_id":"395d0e8aa144436fae5415b45966ecf5","confirmation_msg":{"type":"String","mode":"string","value":""},"id":"402c3ab99b7d4aee9e077702d5e3ee40","name":"End"},{"type":"CRUDAction","mode":"read","read_mode":"variable","variable_id":"ae4d315d70f541fc9775bbee2edbb5fc","script":"(function execute() {\n    var options = [];\n\n    // get variables\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    var count = 0;\n    \n    // query current and future planned outages \n    var gr = new GlideRecordSecure('x_snc_gig_tracker_gig');\n    gr.addEncodedQuery('call_time=javascript:gs.beginningOfToday()')\n    gr.orderByDesc('call_time'); \n    gr.chooseWindow(index, index + limit, true);\n    gr.query();  \n\n    // get total count, used for pagination\n    count = gr.getRowCount();\n    vaVars.count = count;\n\n    // page of outage records\n    var cnt = 0;\n    while(gr.next()) {\n        options.push({ 'value': gr.getUniqueValue(), \n            'label': gr.getDisplayValue('number') + ' [' + gr.getDisplayValue('short_description') + ']'});\n        cnt++;\n    }\n\n    var totalPages = Math.ceil(count / limit).toString();\n    var currentPage = Math.ceil((index+1) / limit).toString();\n\n    // previous and next buttons\n    if ( index &gt; 0 &amp;&amp; cnt &gt; 0 ) {\n        options.push({ 'value': 'prev', 'label': gs.getMessage('Show previous')});\n    }\n    if ( count &gt; index + limit) {\n        options.push({ 'value': 'next', 'label': gs.getMessage('Show more')});\n    }\n    return options;\n})();\n\n","id":"d66c0dac3421411ab67459aca36f8f22","name":"Lookup Gigs","goal_id":"395d0e8aa144436fae5415b45966ecf5","condition":{"type":"Condition","mode":"glide_scripted_query","value":"(function execute() {\n    var options = [];\n\n    // get variables\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    var count = 0;\n    \n    // query current and future planned outages \n    var gr = new GlideRecordSecure('x_snc_gig_tracker_gig');\n    gr.addEncodedQuery('call_time=javascript:gs.beginningOfToday()')\n    gr.orderByDesc('call_time'); \n    gr.chooseWindow(index, index + limit, true);\n    gr.query();  \n\n    // get total count, used for pagination\n    count = gr.getRowCount();\n    vaVars.count = count;\n\n    // page of outage records\n    var cnt = 0;\n    while(gr.next()) {\n        options.push({ 'value': gr.getUniqueValue(), \n            'label': gr.getDisplayValue('number') + ' [' + gr.getDisplayValue('short_description') + ']'});\n        cnt++;\n    }\n\n    var totalPages = Math.ceil(count / limit).toString();\n    var currentPage = Math.ceil((index+1) / limit).toString();\n\n    // previous and next buttons\n    if ( index &gt; 0 &amp;&amp; cnt &gt; 0 ) {\n        options.push({ 'value': 'prev', 'label': gs.getMessage('Show previous')});\n    }\n    if ( count &gt; index + limit) {\n        options.push({ 'value': 'next', 'label': gs.getMessage('Show more')});\n    }\n    return options;\n})();\n\n"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Done","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.lookup_gigs != 'next';\n})()\n"},"id":"8d50d04a98fc430c885e4df336548d64","name":"Done"},{"type":"Branch","label":"Next","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.lookup_gigs == 'next';\n})()\n"},"id":"277e3684bc7147deb4a39c98992b70e5","name":"Next"}],"id":"733fe469878040b7aab14c001a897be5","goal_id":"395d0e8aa144436fae5415b45966ecf5"},{"type":"ScriptedAction","script":"(function execute() {\n    \n        // query assets to get the updated count\n        var gr = new GlideRecordSecure('x_snc_gig_tracker_gig');\n        gr.addEncodedQuery('call_time=javascript:gs.beginningOfToday()')\n        gr.orderByDesc('call_time'); \n        gr.query();  \n    \n        // get total count, to check for existence of next page\n        vaVars.count = gr.getRowCount();\n    \n        // next page math\n        var count = parseInt(vaVars.count);\n        var index = parseInt(vaVars.index);\n        var limit = parseInt(vaVars.limit);\n        if ( index + limit &gt;= count )\n            vaVars.index = 0;\n        else\n            vaVars.index = index + limit;\n        return '';\n    })();\n","id":"b0f41050b5674185a92ce2df2c08be06","name":"Next Page","goal_id":"395d0e8aa144436fae5415b45966ecf5"},{"type":"RecordOutputPrompt","mode":"variable","table":"x_snc_gig_tracker_gig","variable_id":"ae4d315d70f541fc9775bbee2edbb5fc","fields":["short_description","call_time","location"],"id":"9214db00a95e40ddbf6b859e0d977b63","name":"Gig List","goal_id":"395d0e8aa144436fae5415b45966ecf5","condition":{"type":"Condition","mode":"variable","value":""}}],"edges":[{"type":"Edge","source_node_id":"733fe469878040b7aab14c001a897be5","target_node_id":"402c3ab99b7d4aee9e077702d5e3ee40","branch_id":"8d50d04a98fc430c885e4df336548d64","id":"24556edb54254e0ea57ffa798d66dda0","name":"8d50d04a98fc430c885e4df336548d64"},{"type":"Edge","source_node_id":"733fe469878040b7aab14c001a897be5","target_node_id":"b0f41050b5674185a92ce2df2c08be06","branch_id":"277e3684bc7147deb4a39c98992b70e5","id":"100367f17bef48babc21a892b570e557","name":"277e3684bc7147deb4a39c98992b70e5"},{"type":"Edge","source_node_id":"0af52ead8e224343a1606d95078bcd57","target_node_id":"d66c0dac3421411ab67459aca36f8f22","id":"306c1ae6bbcb4f89a30977b9c6190636"},{"type":"Edge","source_node_id":"b0f41050b5674185a92ce2df2c08be06","target_node_id":"d66c0dac3421411ab67459aca36f8f22","id":"6e74a375a95c452d9f4132ae960bcd3b"},{"type":"Edge","source_node_id":"d66c0dac3421411ab67459aca36f8f22","target_node_id":"9214db00a95e40ddbf6b859e0d977b63","id":"cc90f4f3f5ac4715a2faa0c8fbe5450a"},{"type":"Edge","source_node_id":"9214db00a95e40ddbf6b859e0d977b63","target_node_id":"733fe469878040b7aab14c001a897be5","id":"219cda63ed6945528c8b304cc79289bc"}],"id":"395d0e8aa144436fae5415b45966ecf5"}],"script_variables":[],"glide_variables":[{"type":"Reference","table":"x_snc_gig_tracker_gig","id":"ae4d315d70f541fc9775bbee2edbb5fc","name":"lookup_gigs"},{"type":"Reference","table":"sys_user","id":"current-user","name":"user"}],"roles":[],"scope":"c55fd1504f12a300137c4b8d0210c7d0","id":"a0053d26db7a2300f51ef3c61d9619f5","name":"_PRVW__ababf9ee987a23006998ee74213a47c9","key_phrases":["Upcoming Gigs"]}</design_definition>
        <design_topic_id>a0053d26db7a2300f51ef3c61d9619f5</design_topic_id>
        <name>_PRVW__ababf9ee987a23006998ee74213a47c9</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>jesse.adams</sys_created_by>
        <sys_created_on>2019-01-07 14:54:01</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>37abf9eedb7a2300f51ef3c61d9619cd</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="Gig Tracker" source="x_snc_gig_tracker">c55fd1504f12a300137c4b8d0210c7d0</sys_package>
        <sys_policy/>
        <sys_scope display_value="Gig Tracker">c55fd1504f12a300137c4b8d0210c7d0</sys_scope>
        <sys_update_name>sys_cb_design_topic_37abf9eedb7a2300f51ef3c61d9619cd</sys_update_name>
        <sys_updated_by>jesse.adams</sys_updated_by>
        <sys_updated_on>2019-01-07 14:54:01</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
